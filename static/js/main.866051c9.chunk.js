(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{170:function(e,t,n){},171:function(e,t,n){},172:function(e,t,n){},173:function(e,t,n){},174:function(e,t,n){},175:function(e,t,n){},176:function(e,t,n){},177:function(e,t,n){},180:function(e,t,n){},181:function(e,t,n){"use strict";n.r(t);var a=n(0),o=n.n(a),i=n(15),r=n.n(i),l=(n(70),n(40)),c=n.n(l),s=n(61),u=n(11),d=n(12),m=n(14),h=n(13),E=n(18),p=n(2),v=n(5),f=(n(72),n(73),o.a.createContext({token:null,userId:null,login:function(e,t,n){},logout:function(){}})),g="https://graphql-mern-event-booking-api.herokuapp.com/graphql",b=function(e){Object(m.a)(n,e);var t=Object(h.a)(n);function n(e){var a;return Object(u.a)(this,n),(a=t.call(this,e)).state={isLogin:!0},a.switchModeHandler=function(){a.setState((function(e){return{isLogin:!e.isLogin}})),console.log("production"),console.log(Object({NODE_ENV:"production",PUBLIC_URL:"/graphql-mern-event-booking",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,REACT_APP_API_URL:"https://graphql-mern-event-booking-api.herokuapp.com/graphql"}).REACT_APP_API_URI)},a.submitHandler=function(e){e.preventDefault();var t=a.emailEl.current.value,n=a.passwordEl.current.value;if(0!==t.trim().length&&0!==n.trim().length){var o={query:"\n        query Login($email: String!, $pwd: String!) {\n          login(email: $email, password: $pwd) {\n            userId\n            token\n            tokenExpiration\n          }\n        }\n      ",variables:{email:t,pwd:n}};a.state.isLogin||(o={query:"\n          mutation CreateUser($email: String!, $pwd: String!) {\n            createUser(userInput: {email: $email, password: $pwd}) {\n              _id\n              email\n            }\n          }\n        ",variables:{email:t,pwd:n}}),fetch(g,{method:"POST",body:JSON.stringify(o),headers:{"Content-Type":"application/json"}}).then((function(e){if(200!==e.status&&201!==e.status)throw new Error("Authentication Failed!");return e.json()})).then((function(e){e.data.login&&e.data.login.token&&a.state.isLogin?a.context.login(e.data.login.token,e.data.login.userId,e.data.login.tokenExpiration):(v.b.success("Signed up successfully!"),a.switchModeHandler())})).catch((function(e){console.log(e),v.b.error(e.message)}))}},a.emailEl=o.a.createRef(),a.passwordEl=o.a.createRef(),console.log("NODE_ENV","production"),console.log("REACT_APP_API_URI",Object({NODE_ENV:"production",PUBLIC_URL:"/graphql-mern-event-booking",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,REACT_APP_API_URL:"https://graphql-mern-event-booking-api.herokuapp.com/graphql"}).REACT_APP_API_URI),a}return Object(d.a)(n,[{key:"render",value:function(){return o.a.createElement("form",{className:"auth-form",onSubmit:this.submitHandler},o.a.createElement("div",{className:"form-control"},o.a.createElement("label",{htmlFor:"email"},"E-Mail"),o.a.createElement("input",{type:"email",id:"email",ref:this.emailEl})),o.a.createElement("div",{className:"form-control"},o.a.createElement("label",{htmlFor:"password"},"Password"),o.a.createElement("input",{type:"password",id:"password",ref:this.passwordEl})),o.a.createElement("div",{className:"form-actions"},o.a.createElement("button",{type:"submit"},this.state.isLogin?"Login":"Signup"),o.a.createElement("button",{type:"button",onClick:this.switchModeHandler},"Switch to ",this.state.isLogin?"Signup":"Login")))}}]),n}(a.Component);b.contextType=f;var k=b,_=(n(76),function(){return o.a.createElement("div",{className:"spinner"},o.a.createElement("div",{className:"lds-dual-ring"}))}),S=(n(77),function(e){return o.a.createElement("ul",{className:"bookings__list"},e.bookings.map((function(t){return o.a.createElement("li",{key:t._id,className:"bookings__item"},o.a.createElement("div",{className:"bookings__item-data"},o.a.createElement("span",null,t.event.title)," -",new Date(t.createdAt).toLocaleDateString()),o.a.createElement("div",{className:"bookings__item-actions"},o.a.createElement("button",{className:"btn",onClick:e.onDelete.bind(void 0,t._id)},"Cancel")))})))}),y=n(29),C=n(62),w=(n(170),{Cheap:{min:0,max:100},Normal:{min:100,max:200},Expensive:{min:200,max:1e7}}),N=function(e){var t={labels:[],datasets:[]},n=[],a=function(a){var o=e.bookings.reduce((function(e,t){return t.event.price>w[a].min&&t.event.price<=w[a].max?e+1:e}),0);n.push(o),t.labels.push(a),t.datasets.push({label:a,backgroundColor:"rgba(255, 247, 15, 0.5)",borderColor:"rgba(252, 227, 83, 1)",borderWidth:1,hoverBackgroundColor:"rgba(255, 239, 15, 0.6)",hoverBorderColor:"rgba(248, 226, 100, 1)",data:n}),(n=Object(y.a)(n))[n.length-1]=0};for(var i in w)a(i);return o.a.createElement("div",{className:"bookings-chart"},o.a.createElement(C.a,{data:t}))},O=(n(171),function(e){return o.a.createElement("div",{className:"bookings-control"},o.a.createElement("button",{className:"list"===e.activeOutputType?"active":"",onClick:e.onChange.bind(void 0,"list")},"List"),o.a.createElement("button",{className:"chart"===e.activeOutputType?"active":"",onClick:e.onChange.bind(void 0,"chart")},"Chart"))}),T=function(e){Object(m.a)(n,e);var t=Object(h.a)(n);function n(){var e;Object(u.a)(this,n);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return(e=t.call.apply(t,[this].concat(o))).state={isLoading:!1,bookings:[],outputType:"list"},e.fetchBookings=function(){e.setState({isLoading:!0});fetch(g,{method:"POST",body:JSON.stringify({query:"\n          query {\n            bookings {\n              _id\n             createdAt\n             event {\n               _id\n               title\n               date\n               price\n             }\n            }\n          }\n        "}),headers:{"Content-Type":"application/json",Authorization:"Bearer "+e.context.token}}).then((function(e){if(200!==e.status&&201!==e.status)throw new Error("Failed!");return e.json()})).then((function(t){var n=t.data.bookings;e.setState({bookings:n,isLoading:!1})})).catch((function(t){console.log(t),e.setState({isLoading:!1})}))},e.deleteBookingHandler=function(t){e.setState({isLoading:!0});var n={query:"\n          mutation CancelBooking($id: ID!) {\n            cancelBooking(bookingId: $id) {\n            _id\n             title\n            }\n          }\n        ",variables:{id:t}};fetch(g,{method:"POST",body:JSON.stringify(n),headers:{"Content-Type":"application/json",Authorization:"Bearer "+e.context.token}}).then((function(e){if(200!==e.status&&201!==e.status)throw new Error("Failed!");return e.json()})).then((function(n){e.setState((function(e){return{bookings:e.bookings.filter((function(e){return e._id!==t})),isLoading:!1}})),v.b.warn('Event: "'.concat(n.data.cancelBooking.title,'" booking cancelled successfully.'))})).catch((function(t){console.log(t),e.setState({isLoading:!1}),v.b.error(t.message)}))},e.changeOutputTypeHandler=function(t){"list"===t?e.setState({outputType:"list"}):e.setState({outputType:"chart"})},e}return Object(d.a)(n,[{key:"componentDidMount",value:function(){this.fetchBookings()}},{key:"render",value:function(){var e=o.a.createElement(_,null);return this.state.isLoading||(e=o.a.createElement(o.a.Fragment,null,o.a.createElement(O,{activeOutputType:this.state.outputType,onChange:this.changeOutputTypeHandler}),o.a.createElement("div",null,"list"===this.state.outputType?o.a.createElement(S,{bookings:this.state.bookings,onDelete:this.deleteBookingHandler}):o.a.createElement(N,{bookings:this.state.bookings})))),o.a.createElement(o.a.Fragment,null,e)}}]),n}(a.Component);T.contextType=f;var I=T,L=(n(172),function(e){return o.a.createElement("div",{className:"modal"},o.a.createElement("header",{className:"modal__header"},o.a.createElement("h1",null,e.title)),o.a.createElement("section",{className:"modal__content"},e.children),o.a.createElement("section",{className:"modal__actions"},e.canConfirm&&o.a.createElement("button",{className:"btn btn-primary",onClick:e.onConfirm},e.confirmText),e.canCancel&&o.a.createElement("button",{className:"btn",onClick:e.onCancel},"Cancel")))}),R=(n(173),function(e){return o.a.createElement("div",{className:"backdrop"})}),x=(n(174),function(e){return o.a.createElement("li",{key:e.eventId,className:"events__list-item"},o.a.createElement("div",null,o.a.createElement("h1",null,e.title),o.a.createElement("h2",null,o.a.createElement("span",null,"$",e.price)," -"," ",new Date(e.date).toLocaleDateString())),o.a.createElement("div",null,e.userId===e.creatorId?o.a.createElement("p",null,"You're the owner of this event."):o.a.createElement("button",{className:"btn btn-primary",onClick:e.onDetail.bind(void 0,e.eventId)},"View Details")))}),A=(n(175),function(e){var t=e.events.map((function(t){return o.a.createElement(x,{key:t._id,eventId:t._id,title:t.title,price:t.price,date:t.date,userId:e.authUserId,creatorId:t.creator._id,onDetail:e.onViewDetail})}));return o.a.createElement("ul",{className:"event__list"},t)}),D=(n(176),function(e){Object(m.a)(n,e);var t=Object(h.a)(n);function n(e){var a;return Object(u.a)(this,n),(a=t.call(this,e)).state={creating:!1,events:[],isLoading:!1,selectedEvent:null},a.isActive=!0,a.startCreateEventHandler=function(){a.setState({creating:!0})},a.modalConfirmHandler=function(){a.setState({creating:!1});var e=a.titleElRef.current.value,t=+a.priceElRef.current.value,n=a.dateElRef.current.value,o=a.descriptionElRef.current.value;if(!(0===e.trim().length||t<=0||0===n.trim().length||0===o.trim().length)){var i={title:e,price:t,date:n,description:o};console.log(i);var r={query:"\n          mutation CreateEvent($title: String!, $description: String!, $price: Float!, $date: String!) {\n            createEvent(eventInput: {title: $title, description: $description, price: $price, date: $date}) {\n              _id\n              title\n              description\n              date\n              price\n            }\n          }\n        ",variables:{title:e,description:o,price:t,date:n}},l=a.context.token;fetch(g,{method:"POST",body:JSON.stringify(r),headers:{"Content-Type":"application/json",Authorization:"Bearer "+l}}).then((function(e){if(200!==e.status&&201!==e.status)throw new Error("Failed!");return e.json()})).then((function(e){a.setState((function(t){var n=Object(y.a)(t.events);return n.push({_id:e.data.createEvent._id,title:e.data.createEvent.title,description:e.data.createEvent.description,date:e.data.createEvent.date,price:e.data.createEvent.price,creator:{_id:a.context.userId}}),{events:n}})),v.b.success('Event: "'.concat(e.data.createEvent.title,'" created successfully.'))})).catch((function(e){console.log(e),v.b.error(e.message)}))}},a.modalCancelHandler=function(){a.setState({creating:!1,selectedEvent:null})},a.showDetailHandler=function(e){a.setState((function(t){var n=t.events.find((function(t){return t._id===e}));return console.log("this.state.selectedEvent",n),{selectedEvent:n}}))},a.bookEventHandler=function(){if(a.context.token){console.log(a.state.selectedEvent);var e={query:"\n          mutation BookEvent($id: ID!) {\n            bookEvent(eventId: $id) {\n              _id\n             createdAt\n             updatedAt\n             event {\n               title\n             }\n            }\n          }\n        ",variables:{id:a.state.selectedEvent._id}};fetch(g,{method:"POST",body:JSON.stringify(e),headers:{"Content-Type":"application/json",Authorization:"Bearer "+a.context.token}}).then((function(e){if(200!==e.status&&201!==e.status)throw new Error("Failed!");return e.json()})).then((function(e){console.log(e),a.setState({selectedEvent:null}),v.b.success('Event: "'.concat(e.data.bookEvent.event.title,'" booked successfully.'))})).catch((function(e){console.log(e),v.b.error(e.message)}))}else a.setState({selectedEvent:null})},a.titleElRef=o.a.createRef(),a.priceElRef=o.a.createRef(),a.dateElRef=o.a.createRef(),a.descriptionElRef=o.a.createRef(),a}return Object(d.a)(n,[{key:"componentDidMount",value:function(){this.fetchEvents()}},{key:"fetchEvents",value:function(){var e=this;this.setState({isLoading:!0});fetch(g,{method:"POST",body:JSON.stringify({query:"\n          query {\n            events {\n              _id\n              title\n              description\n              date\n              price\n              creator {\n                _id\n                email\n              }\n            }\n          }\n        "}),headers:{"Content-Type":"application/json"}}).then((function(e){if(200!==e.status&&201!==e.status)throw new Error("Failed!");return e.json()})).then((function(t){var n=t.data.events;e.isActive&&e.setState({events:n,isLoading:!1})})).catch((function(t){console.log(t),e.isActive&&e.setState({isLoading:!1})}))}},{key:"componentWillUnmount",value:function(){this.isActive=!1}},{key:"render",value:function(){return o.a.createElement(o.a.Fragment,null,(this.state.creating||this.state.selectedEvent)&&o.a.createElement(R,null),this.state.creating&&o.a.createElement(L,{title:"Add Event",canCancel:!0,canConfirm:!0,onCancel:this.modalCancelHandler,onConfirm:this.modalConfirmHandler,confirmText:"Confirm"},o.a.createElement("form",null,o.a.createElement("div",{className:"form-control"},o.a.createElement("label",{htmlFor:"title"},"Title"),o.a.createElement("input",{type:"text",id:"title",ref:this.titleElRef})),o.a.createElement("div",{className:"form-control"},o.a.createElement("label",{htmlFor:"price"},"Price"),o.a.createElement("input",{type:"number",id:"price",ref:this.priceElRef})),o.a.createElement("div",{className:"form-control"},o.a.createElement("label",{htmlFor:"date"},"Date"),o.a.createElement("input",{type:"datetime-local",id:"date",ref:this.dateElRef})),o.a.createElement("div",{className:"form-control"},o.a.createElement("label",{htmlFor:"description"},"Description"),o.a.createElement("textarea",{id:"description",rows:"4",ref:this.descriptionElRef})))),this.state.selectedEvent&&o.a.createElement(L,{title:this.state.selectedEvent.title,canCancel:!0,canConfirm:!0,onCancel:this.modalCancelHandler,onConfirm:this.bookEventHandler,confirmText:this.context.token?"Book":"Confirm"},o.a.createElement("h2",{className:"events-modal-date"},new Date(this.state.selectedEvent.date).toLocaleDateString()),o.a.createElement("h2",null,"$",this.state.selectedEvent.price),o.a.createElement("p",null,this.state.selectedEvent.description),o.a.createElement("p",null,"For queries, contact at: ",this.state.selectedEvent.creator.email)),this.context.token&&o.a.createElement("div",{className:"events-control"},o.a.createElement("p",null,"Share your own Events!"),o.a.createElement("button",{className:"btn",onClick:this.startCreateEventHandler},"Create Event")),this.state.isLoading?o.a.createElement(_,null):o.a.createElement(A,{events:this.state.events,authUserId:this.context.userId,onViewDetail:this.showDetailHandler}))}}]),n}(a.Component));D.contextType=f;var j=D,P=(n(177),function(e){return o.a.createElement(f.Consumer,null,(function(e){return o.a.createElement("header",{className:"main-navigation"},o.a.createElement("div",{className:"main-navigation__logo"},o.a.createElement("h1",null,"GQLMERN")),o.a.createElement("nav",{className:"main-navigation__items"},o.a.createElement("ul",null,o.a.createElement("li",null,o.a.createElement(E.b,{to:"/events"},"Events")),e.token?o.a.createElement(o.a.Fragment,null,o.a.createElement("li",null,o.a.createElement(E.b,{to:"/bookings"},"Bookings")),o.a.createElement("li",null,o.a.createElement("button",{onClick:e.logout},"Logout"))):o.a.createElement("li",{className:"main-navigation__items__login-link"},o.a.createElement(E.b,{to:"/auth"},"Login / Signup")))))}))});n(180);v.b.configure();var H=function(e){Object(m.a)(n,e);var t=Object(h.a)(n);function n(){var e;Object(u.a)(this,n);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return(e=t.call.apply(t,[this].concat(o))).state={token:null,userId:null},e.initApp=Object(s.a)(c.a.mark((function t(){var n,a;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,localStorage.getItem("TOKEN");case 2:if(t.t0=t.sent,t.t0){t.next=5;break}t.t0=null;case 5:return n=t.t0,t.next=8,localStorage.getItem("USERID");case 8:if(t.t1=t.sent,t.t1){t.next=11;break}t.t1=null;case 11:a=t.t1,e.setState({token:n,userId:a});case 13:case"end":return t.stop()}}),t)}))),e.login=function(t,n,a){e.setState({token:t,userId:n}),localStorage.setItem("TOKEN",t),localStorage.setItem("USERID",n)},e.logout=function(){e.setState({token:null,userId:null}),localStorage.removeItem("TOKEN"),localStorage.removeItem("USERID")},e}return Object(d.a)(n,[{key:"componentDidMount",value:function(){this.initApp()}},{key:"render",value:function(){return o.a.createElement(E.a,null,o.a.createElement(o.a.Fragment,null,o.a.createElement(f.Provider,{value:{token:this.state.token,userId:this.state.userId,login:this.login,logout:this.logout}},o.a.createElement(v.a,null),o.a.createElement(P,null),o.a.createElement("main",{className:"main-content"},o.a.createElement(p.d,null,o.a.createElement(p.b,{path:"/events",component:j}),this.state.token&&o.a.createElement(p.a,{from:"/",to:"/events",exact:!0}),this.state.token&&o.a.createElement(p.a,{from:"/auth",to:"/events",exact:!0}),this.state.token&&o.a.createElement(p.b,{path:"/bookings",component:I}),!this.state.token&&o.a.createElement(p.b,{path:"/auth",component:k}),!this.state.token&&o.a.createElement(p.a,{to:"/auth",exact:!0}))))))}}]),n}(a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(o.a.createElement(o.a.StrictMode,null,o.a.createElement(H,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},65:function(e,t,n){e.exports=n(181)},70:function(e,t,n){},73:function(e,t,n){},76:function(e,t,n){},77:function(e,t,n){}},[[65,1,2]]]);
//# sourceMappingURL=main.866051c9.chunk.js.map